local player = game.Players.LocalPlayer

local function characterLoop(character)
    print("Character loop started for", character)
    local humanoid = character:WaitForChild("Humanoid")
    
    while task.wait(1) do
        if not character or not character.Parent then
            print("Character dead, exiting loop")
            break
        end
        
        humanoid = character:FindFirstChildWhichIsA("Humanoid")
        if not humanoid then break end

        pcall(function()
            humanoid.MaxHealth = 999999
            humanoid.Health = 999999
        end)

        local targetPart = nil
        local disaster = workspace:FindFirstChild("Disaster")
        if disaster then
            local parts = disaster:GetDescendants()
            if #parts > 0 then
                local cand = parts[math.random(1, #parts)]
                if cand:IsA("BasePart") then
                    targetPart = cand
                end
            end
        end

        if not targetPart then
            local map = workspace:FindFirstChild("Map")
            if map then
                local parts = map:GetDescendants()
                if #parts > 0 then
                    local cand = parts[math.random(1, #parts)]
                    if cand:IsA("BasePart") then
                        targetPart = cand
                    end
                end
            end
        end

        if targetPart and humanoid then
            pcall(function()
                humanoid:MoveTo(targetPart.Position)
                humanoid.MoveToFinished:Wait(3)
            end)
        end
    end
end

local function onCharacterAdded(character)
    coroutine.wrap(characterLoop)(character)
end

if player.Character then
    onCharacterAdded(player.Character)
end

player.CharacterAdded:Connect(onCharacterAdded)

print("Main script running, waiting for character events...")
