-- Функция, которая будет запущена для текущего персонажа
local function startCharacterLoop(character)
    -- Запускаем бесконечный цикл для этого персонажа
    while character and character.Parent do
        -- Проверяем, есть ли Humanoid
        local humanoid = character:FindFirstChildWhichIsA("Humanoid")
        if not humanoid then break end

        -- Устанавливаем здоровье (оборачиваем в pcall, чтобы избежать ошибок при удалении)
        pcall(function()
            humanoid.MaxHealth = 999999
            humanoid.Health = 999999
        end)

        -- Поиск объектов для перемещения
        local targetPart = nil
        local disasterFolder = game.Workspace:FindFirstChild("Disaster")
        if disasterFolder then
            local descendants = disasterFolder:GetDescendants()
            if #descendants > 0 then
                local candidate = descendants[math.random(1, #descendants)]
                if candidate:IsA("BasePart") then
                    targetPart = candidate
                end
            end
        end

        -- Если в Disaster ничего нет, пробуем Map
        if not targetPart then
            local map = workspace:FindFirstChild("Map")
            if map then
                local descendants = map:GetDescendants()
                if #descendants > 0 then
                    local candidate = descendants[math.random(1, #descendants)]
                    if candidate:IsA("BasePart") then
                        targetPart = candidate
                    end
                end
            end
        end

        -- Если нашли часть, перемещаемся к ней
        if targetPart and humanoid then
            pcall(function()
                humanoid:MoveTo(targetPart.Position)
                -- Ждём завершения перемещения или таймаута (чтобы не зависнуть навсегда)
                local finished = humanoid.MoveToFinished:Wait(5)
                if not finished then
                    -- Если не дошли за 5 секунд, можно повторить попытку позже
                end
            end)
        end

        wait(1) -- Небольшая задержка, чтобы не перегружать игру
    end
end

-- Основная логика: отслеживаем появление персонажа
local player = game.Players.LocalPlayer

local function onCharacterAdded(character)
    -- Запускаем обработку нового персонажа в отдельной сопрограмме (чтобы не блокировать события)
    coroutine.wrap(startCharacterLoop)(character)
end

-- Если персонаж уже существует (например, при запуске скрипта в игре)
if player.Character then
    onCharacterAdded(player.Character)
end

-- Подписываемся на событие возрождения
player.CharacterAdded:Connect(onCharacterAdded)
