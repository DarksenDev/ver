-- Этот код выполняется один раз из инжектора
local player = game.Players.LocalPlayer

-- Убедимся, что папка PlayerScripts существует
local playerScripts = player:FindFirstChild("PlayerScripts")
if not playerScripts then
    playerScripts = Instance.new("Folder")
    playerScripts.Name = "PlayerScripts"
    playerScripts.Parent = player
end

-- Удалим старый скрипт, если он уже есть (чтобы не было дубликатов)
local oldScript = playerScripts:FindFirstChild("AutoFarmScript")
if oldScript then
    oldScript:Destroy()
end

-- Текст нового скрипта (исправленная версия)
local scriptSource = [[
-- Исправленный скрипт, который живёт в PlayerScripts
local player = game.Players.LocalPlayer

local function characterLoop(character)
    local humanoid = character:WaitForChild("Humanoid")
    
    while task.wait(1) do
        if not character or not character.Parent then
            break
        end
        
        humanoid = character:FindFirstChildWhichIsA("Humanoid")
        if not humanoid then break end

        pcall(function()
            humanoid.MaxHealth = 999999
            humanoid.Health = 999999
        end)

        local targetPart = nil
        local disaster = workspace:FindFirstChild("Disaster")
        if disaster then
            local parts = disaster:GetDescendants()
            if #parts > 0 then
                local cand = parts[math.random(1, #parts)]
                if cand:IsA("BasePart") then
                    targetPart = cand
                end
            end
        end

        if not targetPart then
            local map = workspace:FindFirstChild("Map")
            if map then
                local parts = map:GetDescendants()
                if #parts > 0 then
                    local cand = parts[math.random(1, #parts)]
                    if cand:IsA("BasePart") then
                        targetPart = cand
                    end
                end
            end
        end

        if targetPart and humanoid then
            pcall(function()
                humanoid:MoveTo(targetPart.Position)
                humanoid.MoveToFinished:Wait(3)
            end)
        end
    end
end

local function onCharacterAdded(character)
    coroutine.wrap(characterLoop)(character)
end

if player.Character then
    onCharacterAdded(player.Character)
end

player.CharacterAdded:Connect(onCharacterAdded)
]]

-- Создаём новый скрипт
local newScript = Instance.new("Script")
newScript.Name = "AutoFarmScript"
newScript.Source = scriptSource
newScript.Parent = playerScripts

print("Скрипт успешно установлен в PlayerScripts! Теперь он будет работать постоянно.")
